import{r as n,j as e,R as J}from"./index-DjLJklN1.js";import{a as V,B as q}from"./BlankCard-Bi5qHtB0.js";import{P as K}from"./PageContainer-DXCsbuaA.js";import{T as Q,a as X,b as Y,c as L,d as u,C as A,e as Z,f as ee}from"./CustomCheckbox-CeKz-Be1.js";import{D as R,a as B}from"./DialogContent-CtWUWdOy.js";import{D as O}from"./DialogTitle-C2EZfcf5.js";import{L as se}from"./LinearProgress-1BupFrkL.js";import{S as T}from"./Stack-NByccG3l.js";import{A as P}from"./Alert-81CHHkjh.js";import{T as x}from"./TextField-BLFWIern.js";import{M as I}from"./MenuItem-CfZoc-QB.js";import{D as z}from"./DialogActions-BN6EYxeK.js";import{c as D}from"./Button-7Ql2xwQA.js";import{C as M}from"./CircularProgress-DsWIR91d.js";import{T as W,B as te}from"./Box-Ceze8w59.js";import{S as re}from"./Slide-8maU3OBq.js";import{T as ae}from"./Toolbar-D5wDDIGc.js";import{I as ne}from"./InputAdornment-0ZWWJbaf.js";import{I as oe}from"./IconSearch-C7CF1KOp.js";import{P as ie}from"./Grid2-C7BmHvXf.js";import"./index.esm-Ckl_97PH.js";import"./List-BYtwvu4r.js";import"./Card-Bn8FUNEZ.js";import"./KeyboardArrowRight-CApotXyt.js";import"./IconButton-D01K5F2W.js";import"./Select-CmYIInra.js";import"./useSlot-oTH9YaFV.js";import"./Checkbox-Bl4k4Zle.js";import"./SwitchBase-B9tuHZ1T.js";import"./createStack-BE4hiCiQ.js";import"./Close-NdfeGcxT.js";import"./dividerClasses-Y2SIUT43.js";import"./listItemTextClasses-DrN86Jiw.js";import"./createReactComponent-B5Bwwah4.js";const N=n.createContext({}),le=({children:g})=>{const l="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[t,p]=n.useState([]),[j,c]=n.useState(0),[C,r]=n.useState(!0),[m,a]=n.useState(""),f=async()=>{var h;try{r(!0);const d=await fetch(`${l}/auths/users/`);if(!d.ok)throw new Error("Erreur lors du chargement des utilisateurs");const o=await d.json();p(o.results??o),c(o.count??((h=o.results)==null?void 0:h.length)??o.length)}catch(d){console.error("Erreur fetch utilisateurs:",d),p([]),c(0)}finally{r(!1)}};n.useEffect(()=>{f()},[]);const v=h=>{a(h)},b=t.filter(h=>{var d,o,S,i;return((d=h.username)==null?void 0:d.toLowerCase().includes(m.toLowerCase()))||((o=h.email)==null?void 0:o.toLowerCase().includes(m.toLowerCase()))||((S=h.first_name)==null?void 0:S.toLowerCase().includes(m.toLowerCase()))||((i=h.last_name)==null?void 0:i.toLowerCase().includes(m.toLowerCase()))});return e.jsx(N.Provider,{value:{users:b,totalCount:j,loading:C,search:m,handleSearch:v,fetchUsers:f},children:g})},ce=({open:g,onClose:l,ecole:t,regions:p,categories:j,onUpdated:c})=>{const C="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[r,m]=n.useState({name:"",num_affect:"",address:"",contact:"",gerant:"",num_gerant:"",region:"",categorie:""}),[a,f]=n.useState(!1),[v,b]=n.useState(""),[h,d]=n.useState(!1);n.useEffect(()=>{t&&m({name:t.name||"",num_affect:t.num_affect||"",address:t.address||"",contact:t.contact||"",gerant:t.gerant||"",num_gerant:t.num_gerant||"",region:t.region||"",categorie:t.categorie||""})},[t]);const o=i=>{m({...r,[i.target.name]:i.target.value})},S=async()=>{f(!0),b(""),d(!1);try{if(!(await fetch(`${C}/api/schools/${t.id}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Erreur lors de la mise à jour");d(!0),c(),setTimeout(()=>{f(!1),l()},800)}catch(i){f(!1),b(i.message)}};return t?e.jsxs(R,{open:g,onClose:a?null:l,maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{children:"Modifier l’école"}),a&&e.jsx(se,{}),e.jsx(B,{dividers:!0,children:e.jsxs(T,{spacing:2,mt:1,children:[v&&e.jsx(P,{severity:"error",children:v}),h&&e.jsx(P,{severity:"success",children:"Modification réussie"}),e.jsx(x,{label:"Nom de l’école",name:"name",value:r.name,onChange:o,fullWidth:!0,disabled:a}),e.jsx(x,{label:"Numéro d’affectation",name:"num_affect",value:r.num_affect,onChange:o,fullWidth:!0,disabled:a}),e.jsx(x,{label:"Adresse",name:"address",value:r.address,onChange:o,fullWidth:!0,disabled:a}),e.jsx(x,{label:"Contact",name:"contact",value:r.contact,onChange:o,fullWidth:!0,disabled:a}),e.jsx(x,{label:"Gérant",name:"gerant",value:r.gerant,onChange:o,fullWidth:!0,disabled:a}),e.jsx(x,{label:"Téléphone gérant",name:"num_gerant",value:r.num_gerant,onChange:o,fullWidth:!0,disabled:a}),e.jsx(x,{select:!0,label:"Région",name:"region",value:r.region,onChange:o,fullWidth:!0,disabled:a,children:p.map(i=>e.jsx(I,{value:i.id,children:i.name},i.id))}),e.jsx(x,{select:!0,label:"Catégorie",name:"categorie",value:r.categorie,onChange:o,fullWidth:!0,disabled:a,children:j.map(i=>e.jsx(I,{value:i.id,children:i.name},i.id))})]})}),e.jsxs(z,{children:[e.jsx(D,{onClick:l,disabled:a,children:"Annuler"}),e.jsx(D,{onClick:S,variant:"contained",disabled:a,startIcon:a&&e.jsx(M,{size:18,color:"inherit"}),children:a?"Enregistrement...":"Enregistrer"})]})]}):null},de=({open:g,onClose:l,ecole:t,onDeleted:p})=>{const j="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[c,C]=n.useState(!1),[r,m]=n.useState(""),a=async()=>{C(!0),m("");try{if(!(await fetch(`${j}/api/schools/${t.id}/`,{method:"DELETE"})).ok)throw new Error("Erreur lors de la suppression");p(),l()}catch(f){m(f.message),C(!1)}};return t?e.jsxs(R,{open:g,onClose:c?null:l,children:[e.jsx(O,{children:"Supprimer l’école"}),e.jsx(B,{children:e.jsxs(T,{spacing:2,mt:1,children:[r&&e.jsx(P,{severity:"error",children:r}),e.jsxs(W,{children:["Voulez-vous vraiment supprimer l’école :",e.jsxs("strong",{children:[" ",t.name]})," ?"]}),e.jsx(W,{color:"error",variant:"body2",children:"⚠️ Cette action est irréversible."})]})}),e.jsxs(z,{children:[e.jsx(D,{onClick:l,disabled:c,children:"Annuler"}),e.jsx(D,{color:"error",variant:"contained",onClick:a,disabled:c,startIcon:c&&e.jsx(M,{size:18,color:"inherit"}),children:c?"Suppression...":"Supprimer"})]})]}):null};J.forwardRef(function(l,t){return e.jsx(re,{direction:"up",ref:t,...l})});const ue=()=>{const{users:g,search:l,handleSearch:t}=n.useContext(N),[p,j]=n.useState([]),[c,C]=n.useState(0),[r,m]=n.useState(5),[a,f]=n.useState(!1),[v,b]=n.useState(!1),[h,d]=n.useState(null),[o,S]=n.useState(!1),i=s=>{d(s),b(!0)},$=()=>{b(!1),d(null)},F=s=>{d(s),S(!0)},G=()=>{S(!1),d(null)},H=s=>{if(s.target.checked){j(g.map(w=>w.id));return}j([])},E=g.filter(s=>{var w,y,_,U;return((w=s.username)==null?void 0:w.toLowerCase().includes(l.toLowerCase()))||((y=s.email)==null?void 0:y.toLowerCase().includes(l.toLowerCase()))||((_=s.first_name)==null?void 0:_.toLowerCase().includes(l.toLowerCase()))||((U=s.last_name)==null?void 0:U.toLowerCase().includes(l.toLowerCase()))}),k=c>0?Math.max(0,(1+c)*r-E.length):0;return e.jsxs(te,{children:[e.jsx(ae,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:e.jsx(x,{placeholder:"Rechercher un utilisateur",size:"small",value:l,onChange:s=>t(s.target.value),InputProps:{startAdornment:e.jsx(ne,{position:"start",children:e.jsx(oe,{})})}})}),e.jsxs(ie,{children:[e.jsx(Q,{children:e.jsxs(X,{size:a?"small":"medium",children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(u,{padding:"checkbox",children:e.jsx(A,{checked:p.length===E.length,onChange:H})}),e.jsx(u,{children:"Prénom"}),e.jsx(u,{children:"Nom"}),e.jsx(u,{children:"Email"}),e.jsx(u,{children:"Is Staff"}),e.jsx(u,{children:"Is Active"}),e.jsx(u,{children:"Action"})]})}),e.jsxs(Z,{children:[E.slice(c*r,c*r+r).map(s=>e.jsxs(L,{hover:!0,selected:p.includes(s.id),children:[e.jsx(u,{padding:"checkbox",children:e.jsx(A,{checked:p.includes(s.id)})}),e.jsx(u,{children:s.first_name}),e.jsx(u,{children:s.last_name}),e.jsx(u,{children:s.email}),e.jsx(u,{children:s.is_staff?"Oui":"Non"}),e.jsx(u,{children:s.is_active?"Oui":"Non"}),e.jsx(u,{children:e.jsxs(T,{direction:"row",spacing:1,children:[e.jsx(D,{variant:"outlined",size:"small",onClick:()=>i(s),children:"Modifier"}),e.jsx(D,{variant:"contained",size:"small",color:"error",onClick:()=>F(s),children:"Supprimer"})]})})]},s.id)),k>0&&e.jsx(L,{style:{height:(a?33:53)*k},children:e.jsx(u,{colSpan:8})})]})]})}),e.jsx(ee,{rowsPerPageOptions:[5,10,25],component:"div",count:E.length,rowsPerPage:r,page:c,onPageChange:(s,w)=>C(w),onRowsPerPageChange:s=>m(parseInt(s.target.value,10))})]}),e.jsx(ce,{open:v,onClose:$,user:h,onUpdated:()=>window.location.reload()}),e.jsx(de,{open:o,onClose:G,user:h,onDeleted:()=>window.location.reload()})]})},he=[{to:"/",title:"Utilisateurs"},{title:"Liste des utilisateurs"}],Ve=()=>e.jsx(le,{children:e.jsxs(K,{title:"Liste des utilisateurs",description:"Page des utilisateurs",children:[e.jsx(V,{title:"Utilisateurs",items:he}),e.jsx(q,{children:e.jsx(ue,{})})]})});export{Ve as default};
