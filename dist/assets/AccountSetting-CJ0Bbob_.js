import{r as t,j as e}from"./index-DjLJklN1.js";import{P as k}from"./PageContainer-DXCsbuaA.js";import{a as B,B as _}from"./BlankCard-Bi5qHtB0.js";import{C as p}from"./CustomTextField-SbTLgMVA.js";import{C as u}from"./CustomFormLabel-YcVEnupk.js";import{C as E}from"./CardContent-CgSQ9-dr.js";import{T as b}from"./Box-Ceze8w59.js";import{A as y}from"./Alert-81CHHkjh.js";import{S as T}from"./Stack-NByccG3l.js";import{c as A}from"./Button-7Ql2xwQA.js";import{G as v}from"./Grid2-C7BmHvXf.js";import"./index.esm-Ckl_97PH.js";import"./List-BYtwvu4r.js";import"./Card-Bn8FUNEZ.js";import"./TextField-BLFWIern.js";import"./useSlot-oTH9YaFV.js";import"./Select-CmYIInra.js";import"./Close-NdfeGcxT.js";import"./IconButton-D01K5F2W.js";import"./createStack-BE4hiCiQ.js";const F=()=>{const m="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[r,i]=t.useState(""),[o,a]=t.useState(""),[l,h]=t.useState(""),[f,w]=t.useState(!1),[x,g]=t.useState(""),[C,c]=t.useState(""),P=async()=>{var j,S;if(c(""),g(""),!r||!o||!l){c("Tous les champs sont obligatoires");return}if(o!==l){c("Les mots de passe ne correspondent pas");return}const s=localStorage.getItem("access");if(!s){c("Utilisateur non authentifié");return}try{w(!0);const d=await fetch(`${m}/auth/users/set_password/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({current_password:r,new_password:o})});if(!d.ok){const n=await d.json();throw new Error(((j=n==null?void 0:n.current_password)==null?void 0:j[0])||((S=n==null?void 0:n.new_password)==null?void 0:S[0])||"Erreur lors du changement du mot de passe")}g("Mot de passe modifié avec succès"),i(""),a(""),h("")}catch(d){c(d.message)}finally{w(!1)}};return e.jsxs(E,{children:[e.jsx(b,{variant:"h5",mb:2,children:"Changer le mot de passe"}),C&&e.jsx(y,{severity:"error",sx:{mb:2},children:C}),x&&e.jsx(y,{severity:"success",sx:{mb:2},children:x}),e.jsx(u,{htmlFor:"current-password",children:"Mot de passe actuel"}),e.jsx(p,{id:"current-password",type:"password",fullWidth:!0,value:r,onChange:s=>i(s.target.value)}),e.jsx(u,{htmlFor:"new-password",children:"Nouveau mot de passe"}),e.jsx(p,{id:"new-password",type:"password",fullWidth:!0,value:o,onChange:s=>a(s.target.value)}),e.jsx(u,{htmlFor:"confirm-password",children:"Confirmer le nouveau mot de passe"}),e.jsx(p,{id:"confirm-password",type:"password",fullWidth:!0,value:l,onChange:s=>h(s.target.value)}),e.jsx(T,{direction:"row",justifyContent:"flex-end",mt:3,children:e.jsx(A,{variant:"contained",color:"primary",onClick:P,disabled:f,children:f?"Modification...":"Changer le mot de passe"})})]})},U=[{to:"/",title:"Utilisateurs"},{title:"Changer le mot de passe"}],ee=()=>{const m="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[r,i]=t.useState(null);return t.useEffect(()=>{const o=localStorage.getItem("access");o&&fetch(`${m}/auth/users/me/`,{headers:{Authorization:`Bearer ${o}`}}).then(a=>a.json()).then(a=>i(a)).catch(()=>i(null))},[]),e.jsxs(k,{title:"Changer le mot de passe",description:"Modification du mot de passe",children:[e.jsx(B,{title:"Changer le mot de passe",items:U}),r&&e.jsxs(b,{variant:"h6",sx:{mb:2},children:["Compte connecté :"," ",r.first_name," ",r.last_name]}),e.jsx(v,{container:!0,spacing:3,children:e.jsx(v,{size:{xs:12,md:6},children:e.jsx(_,{children:e.jsx(F,{})})})})]})};export{ee as default};
