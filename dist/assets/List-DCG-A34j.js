import{r,j as e,R as ee}from"./index-DjLJklN1.js";import{a as te,B as se}from"./BlankCard-Bi5qHtB0.js";import{P as re}from"./PageContainer-DXCsbuaA.js";import{T as ae,a as ne,b as oe,c as I,d as i,C as O,e as ie,f as le}from"./CustomCheckbox-CeKz-Be1.js";import"./CustomSwitch-dmg1B5Kk.js";import{D as V,a as q}from"./DialogContent-CtWUWdOy.js";import{D as K}from"./DialogTitle-C2EZfcf5.js";import{L as ce}from"./LinearProgress-1BupFrkL.js";import{S as z}from"./Stack-NByccG3l.js";import{A as N}from"./Alert-81CHHkjh.js";import{T as S}from"./TextField-BLFWIern.js";import{M as L}from"./MenuItem-CfZoc-QB.js";import{D as Q}from"./DialogActions-BN6EYxeK.js";import{c as y}from"./Button-7Ql2xwQA.js";import{C as X}from"./CircularProgress-DsWIR91d.js";import{T as U,B as de}from"./Box-Ceze8w59.js";import{S as he}from"./Slide-8maU3OBq.js";import{T as ue}from"./Toolbar-D5wDDIGc.js";import{I as me}from"./InputAdornment-0ZWWJbaf.js";import{I as ge}from"./IconSearch-C7CF1KOp.js";import{F as G,I as H,S as J}from"./Select-CmYIInra.js";import{P as pe}from"./Grid2-C7BmHvXf.js";import"./index.esm-Ckl_97PH.js";import"./List-BYtwvu4r.js";import"./Card-Bn8FUNEZ.js";import"./KeyboardArrowRight-CApotXyt.js";import"./IconButton-D01K5F2W.js";import"./Checkbox-Bl4k4Zle.js";import"./SwitchBase-B9tuHZ1T.js";import"./Switch-BFXpIW8T.js";import"./createStack-BE4hiCiQ.js";import"./useSlot-oTH9YaFV.js";import"./Close-NdfeGcxT.js";import"./dividerClasses-Y2SIUT43.js";import"./listItemTextClasses-DrN86Jiw.js";import"./createReactComponent-B5Bwwah4.js";const Y=r.createContext({}),fe=({children:C})=>{const[h,a]=r.useState([]),[p,b]=r.useState([]),[g,x]=r.useState([]),[c,f]=r.useState(0),[n,j]=r.useState(!0),[d,v]=r.useState(""),E="https://safeschooldata-6d63cd50a8a3.herokuapp.com",T=async()=>{var s;try{const o=await fetch(`${E}/api/schools/`);if(!o.ok)throw new Error("Erreur fetch écoles");const m=await o.json();a(m.results??m),f(m.count??((s=m.results)==null?void 0:s.length)??m.length)}catch(o){console.error("Erreur fetch écoles:",o),a([]),f(0)}},u=async()=>{try{const s=await fetch(`${E}/api/region/`);if(!s.ok)throw new Error("Erreur fetch régions");const o=await s.json();b(o.results??o)}catch(s){console.error("Erreur fetch régions:",s),b([])}},k=async()=>{try{const s=await fetch(`${E}/api/school-categories/`);if(!s.ok)throw new Error("Erreur fetch catégories");const o=await s.json();x(o.results??o)}catch(s){console.error("Erreur fetch catégories:",s),x([])}};r.useEffect(()=>{(async()=>{await Promise.all([T(),u(),k()]),j(!1)})()},[]);const l=s=>{const o=p.find(m=>m.id===s);return o?o.name:"Non définie"},P=s=>{const o=g.find(m=>m.id===s);return o?o.name:"Non définie"},_=s=>v(s),w=h.map(s=>({...s,region_name:l(s.region),categorie_name:P(s.categorie)})).filter(s=>{var o,m,R,W,A;return((o=s.name)==null?void 0:o.toLowerCase().includes(d.toLowerCase()))||((m=s.num_affect)==null?void 0:m.toLowerCase().includes(d.toLowerCase()))||((R=s.gerant)==null?void 0:R.toLowerCase().includes(d.toLowerCase()))||((W=s.region_name)==null?void 0:W.toLowerCase().includes(d.toLowerCase()))||((A=s.categorie_name)==null?void 0:A.toLowerCase().includes(d.toLowerCase()))});return e.jsx(Y.Provider,{value:{ecoles:w,totalCount:c,loading:n,search:d,handleSearch:_,regions:p,categories:g,getRegionName:l,getCategorieName:P},children:C})},xe=({open:C,onClose:h,ecole:a,regions:p,categories:b,onUpdated:g})=>{const x="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[c,f]=r.useState({name:"",num_affect:"",address:"",contact:"",gerant:"",num_gerant:"",region:"",categorie:""}),[n,j]=r.useState(!1),[d,v]=r.useState(""),[E,T]=r.useState(!1);r.useEffect(()=>{a&&f({name:a.name||"",num_affect:a.num_affect||"",address:a.address||"",contact:a.contact||"",gerant:a.gerant||"",num_gerant:a.num_gerant||"",region:a.region||"",categorie:a.categorie||""})},[a]);const u=l=>{f({...c,[l.target.name]:l.target.value})},k=async()=>{j(!0),v(""),T(!1);try{if(!(await fetch(`${x}/api/schools/${a.id}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).ok)throw new Error("Erreur lors de la mise à jour");T(!0),g(),setTimeout(()=>{j(!1),h()},800)}catch(l){j(!1),v(l.message)}};return a?e.jsxs(V,{open:C,onClose:n?null:h,maxWidth:"md",fullWidth:!0,children:[e.jsx(K,{children:"Modifier l’école"}),n&&e.jsx(ce,{}),e.jsx(q,{dividers:!0,children:e.jsxs(z,{spacing:2,mt:1,children:[d&&e.jsx(N,{severity:"error",children:d}),E&&e.jsx(N,{severity:"success",children:"Modification réussie"}),e.jsx(S,{label:"Nom de l’école",name:"name",value:c.name,onChange:u,fullWidth:!0,disabled:n}),e.jsx(S,{label:"Numéro d’affectation",name:"num_affect",value:c.num_affect,onChange:u,fullWidth:!0,disabled:n}),e.jsx(S,{label:"Adresse",name:"address",value:c.address,onChange:u,fullWidth:!0,disabled:n}),e.jsx(S,{label:"Contact",name:"contact",value:c.contact,onChange:u,fullWidth:!0,disabled:n}),e.jsx(S,{label:"Gérant",name:"gerant",value:c.gerant,onChange:u,fullWidth:!0,disabled:n}),e.jsx(S,{label:"Téléphone gérant",name:"num_gerant",value:c.num_gerant,onChange:u,fullWidth:!0,disabled:n}),e.jsx(S,{select:!0,label:"Région",name:"region",value:c.region,onChange:u,fullWidth:!0,disabled:n,children:p.map(l=>e.jsx(L,{value:l.id,children:l.name},l.id))}),e.jsx(S,{select:!0,label:"Catégorie",name:"categorie",value:c.categorie,onChange:u,fullWidth:!0,disabled:n,children:b.map(l=>e.jsx(L,{value:l.id,children:l.name},l.id))})]})}),e.jsxs(Q,{children:[e.jsx(y,{onClick:h,disabled:n,children:"Annuler"}),e.jsx(y,{onClick:k,variant:"contained",disabled:n,startIcon:n&&e.jsx(X,{size:18,color:"inherit"}),children:n?"Enregistrement...":"Enregistrer"})]})]}):null},je=({open:C,onClose:h,ecole:a,onDeleted:p})=>{const b="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[g,x]=r.useState(!1),[c,f]=r.useState(""),n=async()=>{x(!0),f("");try{if(!(await fetch(`${b}/api/schools/${a.id}/`,{method:"DELETE"})).ok)throw new Error("Erreur lors de la suppression");p(),h()}catch(j){f(j.message),x(!1)}};return a?e.jsxs(V,{open:C,onClose:g?null:h,children:[e.jsx(K,{children:"Supprimer l’école"}),e.jsx(q,{children:e.jsxs(z,{spacing:2,mt:1,children:[c&&e.jsx(N,{severity:"error",children:c}),e.jsxs(U,{children:["Voulez-vous vraiment supprimer l’école :",e.jsxs("strong",{children:[" ",a.name]})," ?"]}),e.jsx(U,{color:"error",variant:"body2",children:"⚠️ Cette action est irréversible."})]})}),e.jsxs(Q,{children:[e.jsx(y,{onClick:h,disabled:g,children:"Annuler"}),e.jsx(y,{color:"error",variant:"contained",onClick:n,disabled:g,startIcon:g&&e.jsx(X,{size:18,color:"inherit"}),children:g?"Suppression...":"Supprimer"})]})]}):null};ee.forwardRef(function(h,a){return e.jsx(he,{direction:"up",ref:a,...h})});const Ce=()=>{const{ecoles:C,regions:h,categories:a,search:p,handleSearch:b}=r.useContext(Y),[g,x]=r.useState(!1),[c,f]=r.useState([]),[n,j]=r.useState(0),[d,v]=r.useState(5),[E,T]=r.useState(!1),[u,k]=r.useState(""),[l,P]=r.useState("");r.useState(!1);const[_,w]=r.useState(null),[s,o]=r.useState(!1),m=t=>{w(t),x(!0)},R=()=>{x(!1),w(null)},W=t=>{if(t.target.checked){f(C.map(D=>D.id));return}f([])},A=t=>{w(t),o(!0)},Z=()=>{o(!1),w(null)},F=C.filter(t=>{var D,$,M;return(((D=t.name)==null?void 0:D.toLowerCase().includes(p.toLowerCase()))||(($=t.num_affect)==null?void 0:$.toLowerCase().includes(p.toLowerCase()))||((M=t.gerant)==null?void 0:M.toLowerCase().includes(p.toLowerCase())))&&(u?t.region===u:!0)&&(l?t.categorie===l:!0)}),B=n>0?Math.max(0,(1+n)*d-F.length):0;return e.jsxs(de,{children:[e.jsxs(ue,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(S,{placeholder:"Rechercher une école",size:"small",value:p,onChange:t=>b(t.target.value),InputProps:{startAdornment:e.jsx(me,{position:"start",children:e.jsx(ge,{})})}}),e.jsxs(G,{size:"small",sx:{minWidth:180},children:[e.jsx(H,{children:"Filtrer par Région"}),e.jsxs(J,{value:u,label:"Filtrer par Région",onChange:t=>k(t.target.value),children:[e.jsx(L,{value:"",children:"Toutes"}),h.map(t=>e.jsx(L,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(G,{size:"small",sx:{minWidth:180},children:[e.jsx(H,{children:"Filtrer par Catégorie"}),e.jsxs(J,{value:l,label:"Filtrer par Catégorie",onChange:t=>P(t.target.value),children:[e.jsx(L,{value:"",children:"Toutes"}),a.map(t=>e.jsx(L,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(pe,{children:[e.jsx(ae,{children:e.jsxs(ne,{size:E?"small":"medium",children:[e.jsx(oe,{children:e.jsxs(I,{children:[e.jsx(i,{padding:"checkbox",children:e.jsx(O,{checked:c.length===F.length,onChange:W})}),e.jsx(i,{children:"Numéro Affectation"}),e.jsx(i,{children:"Nom"}),e.jsx(i,{children:"Adresse"}),e.jsx(i,{children:"Contact"}),e.jsx(i,{children:"Gérant"}),e.jsx(i,{children:"Num Gérant"}),e.jsx(i,{children:"Catégorie"}),e.jsx(i,{children:"Région"}),e.jsx(i,{children:"Action"})]})}),e.jsxs(ie,{children:[F.slice(n*d,n*d+d).map(t=>e.jsxs(I,{hover:!0,selected:c.includes(t.id),children:[e.jsx(i,{padding:"checkbox",children:e.jsx(O,{checked:c.includes(t.id)})}),e.jsx(i,{children:t.num_affect}),e.jsx(i,{children:t.name}),e.jsx(i,{children:t.address}),e.jsx(i,{children:t.contact}),e.jsx(i,{children:t.gerant}),e.jsx(i,{children:t.num_gerant}),e.jsx(i,{children:t.categorie_name}),e.jsx(i,{children:t.region_name}),e.jsx(i,{children:e.jsxs(z,{direction:"row",spacing:1,children:[e.jsx(y,{variant:"outlined",size:"small",onClick:()=>m(t),children:"Modifier"}),e.jsx(y,{variant:"contained",size:"small",color:"error",onClick:()=>A(t),children:"Supprimer"})]})})]},t.id)),B>0&&e.jsx(I,{style:{height:(E?33:53)*B},children:e.jsx(i,{colSpan:10})})]})]})}),e.jsx(le,{rowsPerPageOptions:[5,10,25],component:"div",count:F.length,rowsPerPage:d,page:n,onPageChange:(t,D)=>j(D),onRowsPerPageChange:t=>v(parseInt(t.target.value,10))})]}),e.jsx(xe,{open:g,onClose:R,ecole:_,regions:h,categories:a,onUpdated:()=>window.location.reload()}),e.jsx(je,{open:s,onClose:Z,ecole:_,onDeleted:()=>{window.location.reload()}})]})},Se=[{to:"/",title:"Ecoles"},{title:"Liste des ecoles"}],rt=()=>e.jsx(fe,{children:e.jsxs(re,{title:"Liste des ecoles",description:"Page des incidents",children:[e.jsx(te,{title:"Ecoles",items:Se}),e.jsx(se,{children:e.jsx(Ce,{})})]})});export{rt as default};
