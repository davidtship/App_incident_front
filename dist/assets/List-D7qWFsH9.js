import{j as e,b as X,r as d,u as ne,c as he,R as xe}from"./index-B6sDybhi.js";import{B as me}from"./Breadcrumb-DkqOBDpt.js";import{P as ge}from"./PageContainer-8ZhUrrwU.js";import{a as ae,g as ie,s as y,r as fe,c as _,m as A,b as Y,d as D,e as re,B as U,T as S}from"./Box-DPWK2j67.js";import{S as be}from"./SwitchBase-DHW-IYxN.js";import{c as N,P as Z}from"./Grid2-CvJcK18t.js";import{C as je}from"./CustomSwitch-jgZdTAMB.js";import{S as ve,I as Q}from"./IconCheck-DFJAVVcW.js";import{T as le,I as Ie}from"./IconAlertCircle-DcTJTTRk.js";import{T as Ce}from"./TextField-DsMdupmc.js";import{I as ke}from"./InputAdornment-IHkVYgxx.js";import{I as Be}from"./IconSearch-DTUketiX.js";import{T as f,a as Se,b as ye,c as Pe,d as q,e as Re}from"./TableRow-C5codXY5.js";import{B as Te}from"./Button-BJlF4RCP.js";import{i as Le}from"./List-BtkBOxz5.js";import{K as we,a as Me}from"./KeyboardArrowRight-BvQPt7Wq.js";import{I as W}from"./IconButton-CTflac9t.js";import{S as ze,u as ee,I as De}from"./Select-UAbdyuPp.js";import{M as $e}from"./MenuItem-DSH3xAF1.js";import{D as Ae,a as Ne}from"./DialogContent-Zs42d3yn.js";import{D as Ee}from"./DialogTitle-DmwWc6sf.js";import{S as Fe}from"./Stack-BzGEmwue.js";import{A as He}from"./Avatar-ByhSydLD.js";import{D as Oe}from"./Divider-BpUiWfXp.js";import{c as Ve}from"./createReactComponent-BlY3yTX6.js";import{B as Ue}from"./BlankCard-BaNPcY8i.js";import"./index.esm-9p4OewDm.js";import"./Switch-CikChdGl.js";import"./useSlot-BtFL6hs8.js";import"./isMuiElement-IXU-AiZm.js";import"./listItemTextClasses-DYLEtxQZ.js";import"./Card-CbXakIxi.js";const We=N(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),_e=N(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),Ke=N(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function Ge(t){return ie("MuiCheckbox",t)}const J=ae("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),qe=t=>{const{classes:o,indeterminate:r,color:b,size:x}=t,l={root:["root",r&&"indeterminate",`color${_(b)}`,`size${_(x)}`]},u=re(l,Ge,o);return{...o,...u}},Je=y(be,{shouldForwardProp:t=>fe(t)||t==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,r.indeterminate&&o.indeterminate,o[`size${_(r.size)}`],r.color!=="default"&&o[`color${_(r.color)}`]]}})(A(({theme:t})=>({color:(t.vars||t).palette.text.secondary,variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:X(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(Y()).map(([o])=>({props:{color:o,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[o].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:X(t.palette[o].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(Y()).map(([o])=>({props:{color:o},style:{[`&.${J.checked}, &.${J.indeterminate}`]:{color:(t.vars||t).palette[o].main},[`&.${J.disabled}`]:{color:(t.vars||t).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),Qe=e.jsx(_e,{}),Xe=e.jsx(We,{}),Ye=e.jsx(Ke,{}),Ze=d.forwardRef(function(o,r){const b=ne({props:o,name:"MuiCheckbox"}),{checkedIcon:x=Qe,color:l="primary",icon:u=Xe,indeterminate:h=!1,indeterminateIcon:m=Ye,inputProps:s,size:c="medium",disableRipple:v=!1,className:R,...a}=b,i=h?m:u,T=h?m:x,p={...b,disableRipple:v,color:l,indeterminate:h,size:c},I=qe(p);return e.jsx(Je,{type:"checkbox",inputProps:{"data-indeterminate":h,...s},icon:d.cloneElement(i,{fontSize:i.props.fontSize??c}),checkedIcon:d.cloneElement(T,{fontSize:T.props.fontSize??c}),ownerState:p,ref:r,className:D(I.root,R),...a,classes:I})}),et=N(e.jsx("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage"),tt=N(e.jsx("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),ot=d.forwardRef(function(o,r){const{backIconButtonProps:b,count:x,disabled:l=!1,getItemAriaLabel:u,nextIconButtonProps:h,onPageChange:m,page:s,rowsPerPage:c,showFirstButton:v,showLastButton:R,slots:a={},slotProps:i={},...T}=o,p=he(),I=M=>{m(M,0)},k=M=>{m(M,s-1)},L=M=>{m(M,s+1)},n=M=>{m(M,Math.max(0,Math.ceil(x/c)-1))},g=a.firstButton??W,P=a.lastButton??W,w=a.nextButton??W,E=a.previousButton??W,F=a.firstButtonIcon??et,z=a.lastButtonIcon??tt,j=a.nextButtonIcon??we,C=a.previousButtonIcon??Me,H=p?P:g,O=p?w:E,K=p?E:w,V=p?g:P,G=p?i.lastButton:i.firstButton,B=p?i.nextButton:i.previousButton,pe=p?i.previousButton:i.nextButton,ue=p?i.firstButton:i.lastButton;return e.jsxs("div",{ref:r,...T,children:[v&&e.jsx(H,{onClick:I,disabled:l||s===0,"aria-label":u("first",s),title:u("first",s),...G,children:p?e.jsx(z,{...i.lastButtonIcon}):e.jsx(F,{...i.firstButtonIcon})}),e.jsx(O,{onClick:k,disabled:l||s===0,color:"inherit","aria-label":u("previous",s),title:u("previous",s),...B??b,children:p?e.jsx(j,{...i.nextButtonIcon}):e.jsx(C,{...i.previousButtonIcon})}),e.jsx(K,{onClick:L,disabled:l||(x!==-1?s>=Math.ceil(x/c)-1:!1),color:"inherit","aria-label":u("next",s),title:u("next",s),...pe??h,children:p?e.jsx(C,{...i.previousButtonIcon}):e.jsx(j,{...i.nextButtonIcon})}),R&&e.jsx(V,{onClick:n,disabled:l||s>=Math.ceil(x/c)-1,"aria-label":u("last",s),title:u("last",s),...ue,children:p?e.jsx(F,{...i.firstButtonIcon}):e.jsx(z,{...i.lastButtonIcon})})]})});function st(t){return ie("MuiTablePagination",t)}const $=ae("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]);var te;const nt=y(f,{name:"MuiTablePagination",slot:"Root",overridesResolver:(t,o)=>o.root})(A(({theme:t})=>({overflow:"auto",color:(t.vars||t).palette.text.primary,fontSize:t.typography.pxToRem(14),"&:last-child":{padding:0}}))),at=y(le,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(t,o)=>({[`& .${$.actions}`]:o.actions,...o.toolbar})})(A(({theme:t})=>({minHeight:52,paddingRight:2,[`${t.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[t.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${$.actions}`]:{flexShrink:0,marginLeft:20}}))),it=y("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(t,o)=>o.spacer})({flex:"1 1 100%"}),rt=y("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(t,o)=>o.selectLabel})(A(({theme:t})=>({...t.typography.body2,flexShrink:0}))),lt=y(ze,{name:"MuiTablePagination",slot:"Select",overridesResolver:(t,o)=>({[`& .${$.selectIcon}`]:o.selectIcon,[`& .${$.select}`]:o.select,...o.input,...o.selectRoot})})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${$.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),ct=y($e,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(t,o)=>o.menuItem})({}),dt=y("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(t,o)=>o.displayedRows})(A(({theme:t})=>({...t.typography.body2,flexShrink:0})));function pt({from:t,to:o,count:r}){return`${t}–${o} of ${r!==-1?r:`more than ${o}`}`}function ut(t){return`Go to ${t} page`}const ht=t=>{const{classes:o}=t;return re({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},st,o)},xt=d.forwardRef(function(o,r){const b=ne({props:o,name:"MuiTablePagination"}),{ActionsComponent:x=ot,backIconButtonProps:l,className:u,colSpan:h,component:m=f,count:s,disabled:c=!1,getItemAriaLabel:v=ut,labelDisplayedRows:R=pt,labelRowsPerPage:a="Rows per page:",nextIconButtonProps:i,onPageChange:T,onRowsPerPageChange:p,page:I,rowsPerPage:k,rowsPerPageOptions:L=[10,25,50,100],SelectProps:n={},showFirstButton:g=!1,showLastButton:P=!1,slotProps:w={},slots:E={},...F}=b,z=b,j=ht(z),C=(w==null?void 0:w.select)??n,H=C.native?"option":ct;let O;(m===f||m==="td")&&(O=h||1e3);const K=ee(C.id),V=ee(C.labelId),G=()=>s===-1?(I+1)*k:k===-1?s:Math.min(s,(I+1)*k);return e.jsx(nt,{colSpan:O,ref:r,as:m,ownerState:z,className:D(j.root,u),...F,children:e.jsxs(at,{className:j.toolbar,children:[e.jsx(it,{className:j.spacer}),L.length>1&&e.jsx(rt,{className:j.selectLabel,id:V,children:a}),L.length>1&&e.jsx(lt,{variant:"standard",...!C.variant&&{input:te||(te=e.jsx(De,{}))},value:k,onChange:p,id:K,labelId:V,...C,classes:{...C.classes,root:D(j.input,j.selectRoot,(C.classes||{}).root),select:D(j.select,(C.classes||{}).select),icon:D(j.selectIcon,(C.classes||{}).icon)},disabled:c,children:L.map(B=>d.createElement(H,{...!Le(H)&&{ownerState:z},className:j.menuItem,key:B.label?B.label:B,value:B.value?B.value:B},B.label?B.label:B))}),e.jsx(dt,{className:j.displayedRows,children:R({from:s===0?0:I*k+1,to:G(),count:s===-1?-1:s,page:I})}),e.jsx(x,{className:j.actions,backIconButtonProps:l,count:s,nextIconButtonProps:i,onPageChange:T,page:I,rowsPerPage:k,showFirstButton:g,showLastButton:P,slotProps:w.actions,slots:E.actions,getItemAriaLabel:v,disabled:c})]})})});var mt=Ve("alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);const gt={inputProps:{"aria-label":"Checkbox demo"}},ce=y("span")(({theme:t})=>({borderRadius:3,width:19,height:19,marginLeft:"4px",boxShadow:t.palette.mode==="dark"?`0 0 0 1px ${t.palette.grey[200]}`:`inset 0 0 0 1px ${t.palette.grey[300]}`,backgroundColor:"transparent",".Mui-focusVisible &":{outline:t.palette.mode==="dark"?`0px auto ${t.palette.grey[200]}`:`0px auto  ${t.palette.grey[300]}`,outlineOffset:2},"input:hover ~ &":{backgroundColor:(t.palette.mode==="dark",t.palette.primary)},"input:disabled ~ &":{boxShadow:"none",background:t.palette.grey[100]}})),ft=y(ce)({boxShadow:"none",width:19,height:19,"&:before":{display:"block",width:19,height:19,backgroundImage:`url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M12 5c-.28 0-.53.11-.71.29L7 9.59l-2.29-2.3a1.003 1.003 0 00-1.42 1.42l3 3c.18.18.43.29.71.29s.53-.11.71-.29l5-5A1.003 1.003 0 0012 5z' fill='%23fff'/%3E%3C/svg%3E")`,content:'""'}});function oe(t){return e.jsx(Ze,{disableRipple:!0,color:t.color?t.color:"default",checkedIcon:e.jsx(ft,{sx:{backgroundColor:t.bgcolor?`${t.bgcolor}.main`:"primary.main"}}),icon:e.jsx(ce,{}),...gt,...t})}const de=d.createContext({}),bt=({children:t})=>{const[o,r]=d.useState([]),[b,x]=d.useState(!0),[l,u]=d.useState("");d.useEffect(()=>{(async()=>{try{const c=await fetch("https://safeschooldata-6d63cd50a8a3.herokuapp.com/api/incidents/");if(!c.ok)throw new Error("Erreur lors du fetch des incidents");const v=await c.json();r(v)}catch(c){console.error("Erreur fetch incidents:",c.message),r([])}finally{x(!1)}})()},[]);const h=s=>u(s),m=o.filter(s=>{var c,v;return((c=s.student)==null?void 0:c.toLowerCase().includes(l.toLowerCase()))||((v=s.narration)==null?void 0:v.toLowerCase().includes(l.toLowerCase()))});return e.jsx(de.Provider,{value:{incidents:m,loading:b,search:l,handleSearch:h},children:t})},jt=xe.forwardRef(function(o,r){return e.jsx(ve,{direction:"up",ref:r,...o})}),se={physique:e.jsx(mt,{size:20,color:"#d32f2f"}),moral:e.jsx(Ie,{size:20,color:"#1976d2"}),autre:e.jsx(Q,{size:20,color:"#388e3c"})},vt=()=>{var L;const{incidents:t,search:o,handleSearch:r}=d.useContext(de);d.useState("asc"),d.useState("date");const[b,x]=d.useState([]),[l,u]=d.useState(0),[h,m]=d.useState(5),[s,c]=d.useState(!1),[v,R]=d.useState(!1),[a,i]=d.useState(null),T=n=>{if(n.target.checked){x(t.map(g=>g.id));return}x([])},p=n=>{i(n),R(!0)},I=()=>{R(!1),i(null)},k=l>0?Math.max(0,(1+l)*h-t.length):0;return e.jsxs(U,{children:[e.jsx(le,{children:e.jsx(Ce,{placeholder:"Rechercher un incident",size:"small",value:o,onChange:n=>r(n.target.value),InputProps:{startAdornment:e.jsx(ke,{position:"start",children:e.jsx(Be,{})})}})}),e.jsxs(Z,{children:[e.jsx(Se,{children:e.jsxs(ye,{size:s?"small":"medium",children:[e.jsx(Pe,{children:e.jsxs(q,{children:[e.jsx(f,{padding:"checkbox",children:e.jsx(oe,{checked:b.length===t.length,onChange:T})}),["Élève","Date de naissance","Adresse","Téléphone","Lieu","Type d'incident","Date","Voir"].map((n,g)=>e.jsx(f,{children:n},g))]})}),e.jsxs(Re,{children:[t.slice(l*h,l*h+h).map(n=>{var P;const g=b.indexOf(n.id)!==-1;return e.jsxs(q,{hover:!0,selected:g,children:[e.jsx(f,{padding:"checkbox",children:e.jsx(oe,{checked:g})}),e.jsx(f,{children:n.student}),e.jsx(f,{children:n.dob_student}),e.jsx(f,{children:n.add_student}),e.jsx(f,{children:n.tel}),e.jsx(f,{children:n.place}),e.jsxs(f,{children:[se[(P=n.type)==null?void 0:P.toLowerCase()]||e.jsx(Q,{size:20,color:"#388e3c"})," ",n.type]}),e.jsx(f,{children:new Date(n.date).toLocaleDateString()}),e.jsx(f,{children:e.jsx(Te,{variant:"contained",color:"primary",onClick:()=>p(n),children:"Afficher"})})]},n.id)}),k>0&&e.jsx(q,{style:{height:(s?33:53)*k},children:e.jsx(f,{colSpan:8})})]})]})}),e.jsx(xt,{rowsPerPageOptions:[5,10,25],component:"div",count:t.length,rowsPerPage:h,page:l,onPageChange:(n,g)=>u(g),onRowsPerPageChange:n=>m(parseInt(n.target.value,10))})]}),e.jsxs(U,{ml:2,children:[e.jsx(je,{checked:s,onChange:n=>c(n.target.checked)}),e.jsx(S,{display:"inline",ml:1,children:"Dense padding"})]}),e.jsxs(Ae,{open:v,onClose:I,maxWidth:"sm",fullWidth:!0,TransitionComponent:jt,keepMounted:!0,PaperProps:{sx:{borderRadius:3,overflow:"hidden"}},children:[e.jsx(Ee,{sx:{bgcolor:"#1976d2",color:"#fff",fontWeight:700},children:"Détails de l'incident"}),e.jsx(Ne,{sx:{p:3,bgcolor:"#f5f5f5"},children:a&&e.jsx(Z,{elevation:6,sx:{p:3,borderRadius:3,bgcolor:"#fff",animation:"fadeIn 0.3s ease"},children:e.jsxs(Fe,{spacing:2,children:[e.jsx(U,{display:"flex",justifyContent:"center",children:e.jsx(He,{sx:{bgcolor:"#1976d2",width:80,height:80,fontSize:36,mb:2},children:se[(L=a.type)==null?void 0:L.toLowerCase()]||e.jsx(Q,{size:28,color:"#fff"})})}),e.jsx(S,{variant:"h6",fontWeight:700,children:a.student}),e.jsx(Oe,{}),e.jsxs(S,{children:[e.jsx("strong",{children:"Date de naissance:"})," ",a.dob_student]}),e.jsxs(S,{children:[e.jsx("strong",{children:"Adresse:"})," ",a.add_student]}),e.jsxs(S,{children:[e.jsx("strong",{children:"Téléphone:"})," ",a.tel]}),e.jsxs(S,{children:[e.jsx("strong",{children:"Lieu:"})," ",a.place]}),e.jsxs(S,{children:[e.jsx("strong",{children:"Type d'incident:"})," ",a.type]}),e.jsxs(S,{children:[e.jsx("strong",{children:"Date:"})," ",new Date(a.date).toLocaleDateString()]}),e.jsxs(S,{children:[e.jsx("strong",{children:"Narration:"})," ",a.narration]}),e.jsxs(U,{mt:3,children:[e.jsx(S,{variant:"subtitle1",fontWeight:600,mb:1,children:"Actions prises :"}),(()=>{const n=Array.isArray(a.actionTaken)?a.actionTaken:JSON.parse(a.actionTaken||"[]");return n.length>0?e.jsx("ul",{style:{marginLeft:"20px",lineHeight:"1.8"},children:n.map((g,P)=>e.jsx("li",{style:{fontSize:"16px"},children:g},P))}):e.jsx(S,{children:"Aucune action enregistrée."})})()]})]})})})]})]})},It=[{to:"/",title:"Incident"},{title:"Liste des incidents"}],eo=()=>e.jsx(bt,{children:e.jsxs(ge,{title:"Liste des incidents",description:"Page des incidents",children:[e.jsx(me,{title:"Incidents",items:It}),e.jsx(Ue,{children:e.jsx(vt,{})})]})});export{eo as default};
