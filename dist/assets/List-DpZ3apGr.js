import{r as a,j as e}from"./index-DjLJklN1.js";import{a as $,B as N}from"./BlankCard-Bi5qHtB0.js";import{P as F}from"./PageContainer-DXCsbuaA.js";import{T as G,a as H,b as J,c as D,d as f,C as L,e as V,f as q}from"./CustomCheckbox-CeKz-Be1.js";import{D as I,a as B}from"./DialogContent-CtWUWdOy.js";import{D as z}from"./DialogTitle-C2EZfcf5.js";import{L as K}from"./LinearProgress-1BupFrkL.js";import{S as T}from"./Stack-NByccG3l.js";import{A as P}from"./Alert-81CHHkjh.js";import{T as x}from"./TextField-BLFWIern.js";import{M as A}from"./MenuItem-CfZoc-QB.js";import{D as R}from"./DialogActions-BN6EYxeK.js";import{c as v}from"./Button-7Ql2xwQA.js";import{C as k}from"./CircularProgress-DsWIR91d.js";import{T as W,B as _}from"./Box-Ceze8w59.js";import{T as Q}from"./Toolbar-D5wDDIGc.js";import{I as X}from"./InputAdornment-0ZWWJbaf.js";import{I as Y}from"./IconSearch-C7CF1KOp.js";import{P as Z}from"./Grid2-C7BmHvXf.js";import"./index.esm-Ckl_97PH.js";import"./List-BYtwvu4r.js";import"./Card-Bn8FUNEZ.js";import"./KeyboardArrowRight-CApotXyt.js";import"./IconButton-D01K5F2W.js";import"./Select-CmYIInra.js";import"./useSlot-oTH9YaFV.js";import"./Checkbox-Bl4k4Zle.js";import"./SwitchBase-B9tuHZ1T.js";import"./createStack-BE4hiCiQ.js";import"./Close-NdfeGcxT.js";import"./dividerClasses-Y2SIUT43.js";import"./listItemTextClasses-DrN86Jiw.js";import"./createReactComponent-B5Bwwah4.js";const M=a.createContext({}),ee=({children:d})=>{const h="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[r,j]=a.useState([]),[C,l]=a.useState(0),[p,s]=a.useState(!0),[m,t]=a.useState(""),u=async()=>{var g;try{s(!0);const c=await fetch(`${h}/api/school-categories/`);if(!c.ok)throw new Error("Erreur lors du chargement des catégories");const o=await c.json();j(o.results??o),l(o.count??((g=o.results)==null?void 0:g.length)??o.length)}catch(c){console.error("Erreur fetch catégories:",c),j([]),l(0)}finally{s(!1)}};a.useEffect(()=>{u()},[]);const S=g=>{t(g)},b=r.filter(g=>{var c;return(c=g.name)==null?void 0:c.toLowerCase().includes(m.toLowerCase())});return e.jsx(M.Provider,{value:{categories:b,totalCount:C,loading:p,search:m,handleSearch:S,fetchCategories:u},children:d})},te=({open:d,onClose:h,ecole:r,regions:j,categories:C,onUpdated:l})=>{const p="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[s,m]=a.useState({name:"",num_affect:"",address:"",contact:"",gerant:"",num_gerant:"",region:"",categorie:""}),[t,u]=a.useState(!1),[S,b]=a.useState(""),[g,c]=a.useState(!1);a.useEffect(()=>{r&&m({name:r.name||"",num_affect:r.num_affect||"",address:r.address||"",contact:r.contact||"",gerant:r.gerant||"",num_gerant:r.num_gerant||"",region:r.region||"",categorie:r.categorie||""})},[r]);const o=i=>{m({...s,[i.target.name]:i.target.value})},y=async()=>{u(!0),b(""),c(!1);try{if(!(await fetch(`${p}/api/schools/${r.id}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Erreur lors de la mise à jour");c(!0),l(),setTimeout(()=>{u(!1),h()},800)}catch(i){u(!1),b(i.message)}};return r?e.jsxs(I,{open:d,onClose:t?null:h,maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{children:"Modifier l’école"}),t&&e.jsx(K,{}),e.jsx(B,{dividers:!0,children:e.jsxs(T,{spacing:2,mt:1,children:[S&&e.jsx(P,{severity:"error",children:S}),g&&e.jsx(P,{severity:"success",children:"Modification réussie"}),e.jsx(x,{label:"Nom de l’école",name:"name",value:s.name,onChange:o,fullWidth:!0,disabled:t}),e.jsx(x,{label:"Numéro d’affectation",name:"num_affect",value:s.num_affect,onChange:o,fullWidth:!0,disabled:t}),e.jsx(x,{label:"Adresse",name:"address",value:s.address,onChange:o,fullWidth:!0,disabled:t}),e.jsx(x,{label:"Contact",name:"contact",value:s.contact,onChange:o,fullWidth:!0,disabled:t}),e.jsx(x,{label:"Gérant",name:"gerant",value:s.gerant,onChange:o,fullWidth:!0,disabled:t}),e.jsx(x,{label:"Téléphone gérant",name:"num_gerant",value:s.num_gerant,onChange:o,fullWidth:!0,disabled:t}),e.jsx(x,{select:!0,label:"Région",name:"region",value:s.region,onChange:o,fullWidth:!0,disabled:t,children:j.map(i=>e.jsx(A,{value:i.id,children:i.name},i.id))}),e.jsx(x,{select:!0,label:"Catégorie",name:"categorie",value:s.categorie,onChange:o,fullWidth:!0,disabled:t,children:C.map(i=>e.jsx(A,{value:i.id,children:i.name},i.id))})]})}),e.jsxs(R,{children:[e.jsx(v,{onClick:h,disabled:t,children:"Annuler"}),e.jsx(v,{onClick:y,variant:"contained",disabled:t,startIcon:t&&e.jsx(k,{size:18,color:"inherit"}),children:t?"Enregistrement...":"Enregistrer"})]})]}):null},se=({open:d,onClose:h,ecole:r,onDeleted:j})=>{const C="https://safeschooldata-6d63cd50a8a3.herokuapp.com",[l,p]=a.useState(!1),[s,m]=a.useState(""),t=async()=>{p(!0),m("");try{if(!(await fetch(`${C}/api/schools/${r.id}/`,{method:"DELETE"})).ok)throw new Error("Erreur lors de la suppression");j(),h()}catch(u){m(u.message),p(!1)}};return r?e.jsxs(I,{open:d,onClose:l?null:h,children:[e.jsx(z,{children:"Supprimer l’école"}),e.jsx(B,{children:e.jsxs(T,{spacing:2,mt:1,children:[s&&e.jsx(P,{severity:"error",children:s}),e.jsxs(W,{children:["Voulez-vous vraiment supprimer l’école :",e.jsxs("strong",{children:[" ",r.name]})," ?"]}),e.jsx(W,{color:"error",variant:"body2",children:"⚠️ Cette action est irréversible."})]})}),e.jsxs(R,{children:[e.jsx(v,{onClick:h,disabled:l,children:"Annuler"}),e.jsx(v,{color:"error",variant:"contained",onClick:t,disabled:l,startIcon:l&&e.jsx(k,{size:18,color:"inherit"}),children:l?"Suppression...":"Supprimer"})]})]}):null},re=()=>{const{categories:d,loading:h,search:r,handleSearch:j,fetchCategories:C}=a.useContext(M),[l,p]=a.useState([]),[s,m]=a.useState(0),[t,u]=a.useState(5),[S,b]=a.useState(!1),[g,c]=a.useState(!1),[o,y]=a.useState(null),i=n=>{if(n.target.checked){p(d.map(E=>E.id));return}p([])},O=n=>{y(n),b(!0)},U=n=>{y(n),c(!0)},w=s>0?Math.max(0,(1+s)*t-d.length):0;return h?e.jsx(_,{display:"flex",justifyContent:"center",mt:4,children:e.jsx(k,{})}):e.jsxs(_,{children:[e.jsx(Q,{children:e.jsx(x,{size:"small",placeholder:"Rechercher une catégorie",value:r,onChange:n=>j(n.target.value),InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(Y,{size:18})})}})}),e.jsxs(Z,{children:[e.jsx(G,{children:e.jsxs(H,{children:[e.jsx(J,{children:e.jsxs(D,{children:[e.jsx(f,{padding:"checkbox",children:e.jsx(L,{checked:d.length>0&&l.length===d.length,onChange:i})}),e.jsx(f,{children:"Nom"}),e.jsx(f,{children:"Description"}),e.jsx(f,{align:"right",children:"Actions"})]})}),e.jsxs(V,{children:[d.slice(s*t,s*t+t).map(n=>e.jsxs(D,{hover:!0,children:[e.jsx(f,{padding:"checkbox",children:e.jsx(L,{checked:l.includes(n.id)})}),e.jsx(f,{children:n.name}),e.jsx(f,{children:n.description||"-"}),e.jsx(f,{align:"right",children:e.jsxs(T,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(v,{variant:"outlined",size:"small",onClick:()=>O(n),children:"Modifier"}),e.jsx(v,{variant:"contained",color:"error",size:"small",onClick:()=>U(n),children:"Supprimer"})]})})]},n.id)),w>0&&e.jsx(D,{style:{height:53*w},children:e.jsx(f,{colSpan:4})})]})]})}),e.jsx(q,{component:"div",rowsPerPageOptions:[5,10,25],count:d.length,rowsPerPage:t,page:s,onPageChange:(n,E)=>m(E),onRowsPerPageChange:n=>u(parseInt(n.target.value,10))})]}),e.jsx(te,{open:S,categorie:o,onClose:()=>b(!1),onUpdated:C}),e.jsx(se,{open:g,categorie:o,onClose:()=>c(!1),onDeleted:C})]})},ae=[{to:"/",title:"Catégories scolaires"},{title:"Liste des catégories"}],Me=()=>e.jsx(ee,{children:e.jsxs(F,{title:"Liste des catégories scolaires",description:"Page de gestion des catégories scolaires",children:[e.jsx($,{title:"Catégories scolaires",items:ae}),e.jsx(N,{children:e.jsx(re,{})})]})});export{Me as default};
